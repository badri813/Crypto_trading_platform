{% include 'uhead.html' %}
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>User Profile</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
  <style>
    .profile-container {
      max-width: 1100px;
      margin: 40px auto;
      display: grid;
      grid-template-columns: 1fr 2fr;
      gap: 20px;
    }
    .card-box {
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 6px 18px rgba(0,0,0,0.1);
      padding: 25px;
    }
    .crypto-table th, .crypto-table td {
      text-align: center;
      vertical-align: middle;
    }
    .btn-sell-total {
      margin-top: 15px;
      display: block;
      width: 100%;
    }
  </style>
</head>
<body class="bg-light">

<div class="profile-container">
  <!-- Left: User Details -->
  <div class="card-box">
    <h3>User Details</h3>
    <p><strong>Name:</strong> {{ user['name'] }}</p>
    <p><strong>Email:</strong> {{ user['email'] }}</p>
    <p><strong>Phone:</strong> {{ user['phone'] }}</p>
    <p><strong>Wallet Balance:</strong> $ {{ "%.2f"|format(wallet['amount']|float) if wallet else 0.00 }}</p>
  </div>

  <!-- Right: Portfolio -->
  <div class="card-box">
    <h3>My Portfolio</h3>
    <table class="table table-striped table-hover crypto-table">
      <thead>
        <tr>
          <th>Ticker</th>
<!--          <th>Total Bought</th>-->
<!--          <th>Total Sold</th>-->
          <th>Coin</th>
          <th>Market Value</th>
        </tr>
      </thead>
      <tbody>
        {% for row in portfolio %}
        <tr>
          <td>{{ row['ticker'] }}</td>
<!--          <td>{{ row['total_bought'] }}</td>-->
<!--          <td>{{ row['total_sold'] }}</td>-->
          <td>{{ "%.8f"|format(row['remaining_coins']) }}</td>
          <td>{{ "%.2f"|format(row['market_value']) }}</td>


        </tr>
        {% endfor %}
      </tbody>
      <tfoot>
        <tr class="fw-bold">
          <td colspan="2" class="text-end">Total Market Value</td>
          <td>{{ "%.2f"|format(total_market_value) }}</td>
        </tr>
      </tfoot>
    </table>

    <!-- Global Sell on P2P Button after card -->
    <form method="POST" action="/sell_p2p">
        <input type="hidden" name="total_market_value" value="{{ total_market_value }}">
        {% if p2p_orders and p2p_orders[0].transaction_id %}
            <input type="text" name="transaction_id" value="{{ p2p_orders[0].transaction_id }}">
        {% endif %}
        <button type="submit" class="btn btn-danger w-50 ml-150 btn-sell-total">
            Sell Entire Portfolio on P2P
        </button>
    </form>

  </div>
</div>

<div class="card-box mt-3">
  <h3>My P2P Orders</h3>
  {% if p2p_orders %}
  <table class="table table-striped table-hover crypto-table">
    <thead>
      <tr>
        <th>Order ID</th>
        <th>Ticker</th>
        <th>Coins Available</th>
        <th>Price</th>
        <th>Total Value</th>
        <th>Payment Mode</th>
        <th>Status</th>
        <th>Created At</th>
      </tr>
    </thead>
    <tbody>
      {% for order in p2p_orders %}
      <tr>
        <td>{{ order['order_id'] }}</td>
        <td>{{ order['ticker'] }}</td>
        <td>{{ order['coins_available'] }}</td>
        <td>{{ "%.8f"|format(order['price']) }}</td>
        <td>{{ "%.8f"|format(order['coins_available'] * order['price']) }}</td>
        <td>{{ order['payment_mode'] }}</td>
        <td>{{ order['status'] }}</td>
        <td>{{ order['created_at'] }}</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
  {% else %}
  <p>No P2P orders yet.</p>
  {% endif %}
</div>

</body>
</html>
